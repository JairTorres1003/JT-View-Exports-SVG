name: Console.log Checker

on:
  pull_request:
    types:
      - opened
      - synchronize

jobs:
  check-console-log:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Count modified files
      id: count-files
      run: |
        # Count the modified files
        changed_files=$(git diff --name-only ${{ github.event.before }} ${{ github.sha }})
        file_count=$(echo "$changed_files" | wc -l)
        echo "FILES_CHANGED=$file_count" >> $GITHUB_ENV

    - name: Comment on Pull Request
      run: |
        if [[ $FILES_CHANGED -gt 0 ]]; then
          echo "Found $FILES_CHANGED modified files."
        else
          echo "No files were modified."
        fi

    - name: Find console.log
      run: |
        # Search for modified TypeScript and TypeScript React files containing console.log
        changed_files=$(git diff --name-only ${{ github.event.before }} ${{ github.sha }})

        for file in $changed_files; do
          if [[ $file == *.ts || $file == *.tsx ]]; then
            if grep -q "console.log" "$file"; then
              echo "Found a console.log in the TypeScript/TSX file: $file"
              echo "Please remove the console.log statements from this file."
              # Use GitHub Actions Workflow Commands to comment on the Pull Request
              echo "::warning file=$file,line=1::Found a console.log in this TypeScript/TSX file, please remove it."
            fi
          fi
        done
